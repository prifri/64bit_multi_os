# 08 -> 09

# IA-32e 64bit 모드의 4단계 paging과 address 변환 과정

address를 보면 다음과 같다.

부호 확장[63:48]
PML4[47:39] -> PML4 로 관리한다.
디렉터리포인터[38:30] -> PDPT 로 관리한다.
디렉터리[29:21] -> PDE 로 관리한다.
오프셋[0:20] -> PTE 로 관리한다.

- 2MB paging이니 offset단위는 2MB일 것이다.

PTE 한개당 2MB

- directory 가 2^9개이다. 즉 directory 한개당 512개. 2MB * 512 = 1GB.
- 4kb / 8 = 512. 1개의 page에 512개씩 관리가능하다.
- 512개는 1GB. 64GB를 사용하므로 512 * 64개의 entry가 필요하며 64개의 page가 필요.

PDE 한개당 1GB

- directory pointer가 2^9개이다. 즉 DP한개당 512개. 1GB * 512 = 512GB.
- 512개를 관리해야되므로 8byte * 512 = 4kb가 필요하다.
- 64GB를 관리하므로 1개 만 사용하면된다. = 4kb

PDPT 한개당 512GB

- PML4가 2^9개이다. 즉 PML4한개당 512개. 512GB * 512 = 256TB 
- 512개를 관리해야되므로 8byte * 512 = 4kb가 필요하다.
- 64GB를 관리하므로 1개 만 사용하면된다. = 4kb

```
------------- ...

IA-32e

------------- 0x200000


----- 0x142000 
               ^
PDE 8*512=4kb  |
4kb*64=256kb   |
               |
----- 0x102000 | Page Table 256 + 4 + 4 = 264 kb
PDP 8*512=4kb  |
----- 0x101000 |
PML4 4kb       v
------------- 0x100000

BIOS, 

----- 0x00
```

# 수정사항
